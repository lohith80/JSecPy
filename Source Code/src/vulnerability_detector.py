# vulnerability_detector.py

import json
from pathlib import Path
from typing import List, Dict

def load_owasp_top_10() -> Dict:
    """
    Loads the OWASP Top 10 vulnerability data from the JSON file.

    :return: A dictionary containing the OWASP Top 10 vulnerability data
    """
    owasp_top_10_file = Path(__file__).parent.parent / "data" / "owasp_top10.json"
    with owasp_top_10_file.open("r") as file:
        owasp_top_10 = json.load(file)
    return owasp_top_10

def detect_vulnerabilities(detected_vulnerabilities: List[Dict]) -> List[Dict]:
    """
    Detects vulnerabilities based on OWASP Top 10 list.

    :param detected_vulnerabilities: The list of detected vulnerabilities
    :return: A list of vulnerabilities based on OWASP Top 10
    """
    owasp_top_10 = load_owasp_top_10()
    vulnerabilities = []

    for detected_vulnerability in detected_vulnerabilities:
        vulnerability_name = detected_vulnerability["name"]

        if vulnerability_name in owasp_top_10:
            vulnerabilities.append({
                "name": vulnerability_name,
                #"description": f"Line {detected_vulnerability['line_number']}: {detected_vulnerability['line']} -> {detected_vulnerability['description']} ",
                "description": f"Line {detected_vulnerability['line_number']}: {detected_vulnerability['line']}",
                "owasp_rank": owasp_top_10[vulnerability_name]["rank"],
                "risk_level": owasp_top_10[vulnerability_name]["risk_level"],
            })

    return vulnerabilities
